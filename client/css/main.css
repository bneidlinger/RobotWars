/* client/css/main.css - Refined Layout (API/Arena/Consoles in Col 1) */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'VT323', monospace;
    font-size: 20px;
    background-color: #1e1e1e;
    color: #e0e0e0;
    line-height: 1.6;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;
}

.container {
    width: 100%;
    padding: 15px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    min-height: 0;
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px; /* Further reduced margin */
    padding-bottom: 10px;
    border-bottom: 1px solid #444;
    flex-wrap: wrap;
    flex-shrink: 0;
}

header img.header-logo {
    max-height: 35px;
    width: auto;
    vertical-align: middle;
    margin-right: 10px;
}

header h1 {
    font-family: 'Press Start 2P', cursive;
    font-size: 1.6rem;
    color: #4CAF50;
    margin: 0 10px 0 0;
    display: inline-block;
    vertical-align: middle;
    flex-shrink: 0;
}

nav {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

/* --- Button, Select, Input Styles --- */
button, select {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-family: 'VT323', monospace;
    font-size: 15px;
}
button:hover, select:hover { background-color: #45a049; }
button:disabled { background-color: #555; color: #aaa; cursor: not-allowed; }
button:disabled:hover { background-color: #555; }
#btn-test-code { background-color: #2196F3; }
#btn-test-code:hover { background-color: #1e88e5; }
#btn-self-destruct { background-color: #e74c3c; padding: 6px 12px; }
#btn-self-destruct:hover { background-color: #c0392b; }
select { background-color: #333; }
select:disabled { background-color: #555; color: #aaa; cursor: not-allowed; }
input#playerName {
    font-family: 'VT323', monospace;
    font-size: 15px;
    background-color: #333;
    color: #e0e0e0;
    border: 1px solid #555;
    padding: 8px;
    border-radius: 4px;
    margin-right: 5px;
}
input#playerName:disabled { background-color: #555; color: #aaa; cursor: not-allowed; }


/* === Main Content Grid === */
.main-content-grid {
    display: grid;
    /* Adjusted Columns: Arena col slightly wider, Dev col narrower */
    grid-template-columns: minmax(450px, 3.5fr) minmax(300px, 1.8fr) minmax(300px, 1.5fr);
    grid-template-rows: 1fr;
    gap: 15px;
    flex-grow: 1;
    min-height: 0;
    width: 100%;
    overflow: hidden;
}


/* === Column Styling === */
.arena-column {
    /* CHANGED: Now stacks API, Arena, Consoles Row */
    display: flex;
    flex-direction: column;
    gap: 10px; /* Space between API, Arena, Consoles Row */
    min-width: 0;
    min-height: 0;
    /* REMOVED justify/align center */
    overflow: hidden; /* Contain children */
}

.devtools-column, /* Now contains only Editor Section */
.info-lobby-column { /* No structural change needed here */
    display: flex;
    flex-direction: column;
    gap: 15px;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
}

/* Arena Column Content Styling */
.api-help {
    /* Now positioned in arena-column */
    background-color: #333;
    padding: 8px 12px; /* Reduced padding */
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    flex-shrink: 0; /* Don't shrink API help */
    max-height: 140px; /* Keep API help relatively small */
    overflow-y: auto; /* Scroll if needed */
    border: 1px solid #444; /* Add border for definition */
}
.api-help h4 {
    font-family: 'VT323', monospace;
    font-size: 16px; /* Smaller title */
    margin-bottom: 5px;
    color: #aaa; /* Subdued color */
    flex-shrink: 0;
    padding-bottom: 3px;
    border-bottom: 1px solid #555;
}
.api-help ul { list-style-position: inside; padding-left: 5px; }
.api-help li { margin-bottom: 4px; font-size: 15px; }
.api-help code {
    font-family: 'VT323', monospace;
    background-color: #444; padding: 2px 4px; border-radius: 3px;
    color: #f0f0f0; font-size: 14px;
}


#arena {
    background-color: #2c2c2c;
    border: 2px solid #444;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: block;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    aspect-ratio: 1 / 1;
    /* ADDED: Allow arena to grow and fill vertical space */
    flex-grow: 1;
    min-height: 200px; /* Ensure minimum drawing space */
}

/* NEW: Styling for the row containing the two consoles */
.consoles-row {
    display: flex; /* Arrange consoles side-by-side */
    gap: 15px; /* Space between consoles */
    width: 100%;
    flex-shrink: 0; /* Prevent row from shrinking */
}

/* Styling for console panels *within* the consoles-row */
.consoles-row .console-panel {
    flex: 1; /* Each console takes half the width */
    min-width: 0; /* Allow shrinking within flex */
    display: flex; /* Use flex internally */
    flex-direction: column; /* Stack title and log-box */
    max-height: 250px; /* ADJUST max height for consoles */
    /* Base panel styles (already defined below, ensure they apply) */
    background-color: #333;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden; /* Hide panel overflow */
}

/* Ensure log-box within consoles scrolls */
.consoles-row .console-panel .log-box {
     overflow-y: auto;
     flex-grow: 1; /* Allow log-box to fill vertical space */
     min-height: 50px; /* Prevent collapsing */
     scrollbar-width: thin;
     scrollbar-color: #666 #333;
}
.consoles-row .console-panel .log-box::-webkit-scrollbar { width: 8px; }
.consoles-row .console-panel .log-box::-webkit-scrollbar-track { background: #333; border-radius: 4px; }
.consoles-row .console-panel .log-box::-webkit-scrollbar-thumb { background-color: #666; border-radius: 4px; border: 2px solid #333; }


/* === Panel Base Styles (used by multiple elements) === */
.console-panel,
.stats-panel,
/* .api-help, /* API help styled separately now */
#lobby-area,
#game-history-log,
.editor-section /* Apply panel bg/border to editor section */
{
    background-color: #333;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #444; /* Default border */
    flex-shrink: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* Default max height for panels in info column */
.stats-panel,
#lobby-area,
#game-history-log {
    max-height: 250px; /* Adjust as needed */
}

/* Scrollable content within panels */
.log-box,
#robot-stats,
#game-history-list {
    overflow-y: auto;
    flex-grow: 1;
    min-height: 50px;
    font-family: 'VT323', monospace;
    word-wrap: break-word;
    padding: 5px;
    scrollbar-width: thin;
    scrollbar-color: #666 #333;
}
.log-box::-webkit-scrollbar,
#robot-stats::-webkit-scrollbar,
#game-history-list::-webkit-scrollbar { width: 8px; }
.log-box::-webkit-scrollbar-track,
#robot-stats::-webkit-scrollbar-track,
#game-history-list::-webkit-scrollbar-track { background: #333; border-radius: 4px; }
.log-box::-webkit-scrollbar-thumb,
#robot-stats::-webkit-scrollbar-thumb,
#game-history-list::-webkit-scrollbar-thumb { background-color: #666; border-radius: 4px; border: 2px solid #333; }

#robot-stats { padding: 0; }


/* Titles inside panels */
.console-panel h3,
.stats-panel h3,
.editor-section h3,
/* .api-help h4, /* API help styled separately */
#lobby-area h3,
#game-history-log h4 {
    font-family: 'VT323', monospace;
    font-size: 18px;
    margin-bottom: 8px;
    color: #4CAF50;
    flex-shrink: 0;
    padding-bottom: 5px;
    border-bottom: 1px solid #555;
}


/* === DevTools Column (Editor Only) === */
.editor-section {
    display: flex;
    flex-direction: column;
    flex-grow: 1; /* Editor section takes ALL space in DevTools column */
    min-height: 0; /* Was 300px, let flex handle it */
    overflow: hidden;
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #444;
    max-height: none; /* Remove max-height */
}
.editor-section h3 {
    border-bottom: none;
    margin-bottom: 5px;
    padding-bottom: 0;
    color: #aaa;
    font-size: 16px;
}

.code-editor-wrapper {
    flex-grow: 1;
    min-height: 200px;
    position: relative;
    display: flex;
    margin-bottom: 10px;
}

.CodeMirror {
    flex-grow: 1;
    height: auto !important;
    border-radius: 4px;
    border: 1px solid #444;
    font-family: 'VT323', monospace;
    font-size: 16px;
}
.CodeMirror-readonly .CodeMirror-cursor { display: none !important; }
.CodeMirror-readonly { background-color: #222 !important; }

.editor-controls {
     display: flex;
     gap: 10px;
     align-items: center;
     flex-shrink: 0;
     margin-bottom: 5px;
}
#btn-delete-loadout { padding: 4px 8px; font-size: 14px; background-color: #c0392b; }
#btn-delete-loadout:hover { background-color: #a93226; }
#btn-delete-loadout:disabled { background-color: #555; color: #aaa; }
#loadout-status { font-size: 14px; min-height: 1.2em; color: #aaa; flex-shrink: 0; }


/* === Console Log Specific Themes === */
#robot-console-log { border-color: #0f400f; background-color: #1a1a1a; }
#robot-console-log h3 { color: #00dd00; text-shadow: 0 0 4px #00dd00; text-align: center; border-bottom: none; }
#robot-log-messages { background-color: #000000; color: #00FF41; font-size: 16px; border: 1px solid #004d00; text-shadow: 0 0 5px rgba(0, 255, 65, 0.5); position: relative; }
#robot-log-messages::after { /* Scanline */ content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: rgba(0, 255, 0, 0.15); box-shadow: 0 0 4px 1px rgba(0, 255, 0, 0.15); z-index: 3; pointer-events: none; animation: scanline-log 6s linear infinite; }

#opponent-console-log { border-color: #4d0000; background-color: #1a1010; }
#opponent-console-log h3 { color: #ff4136; text-shadow: 0 0 4px #ff4136; text-align: center; border-bottom: none; }
#opponent-log-messages { background-color: #000000; color: #FF4136; font-size: 16px; border: 1px solid #4d0000; text-shadow: 0 0 5px rgba(255, 65, 54, 0.5); position: relative; }
#opponent-log-messages::after { /* Scanline */ content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: rgba(255, 65, 54, 0.15); box-shadow: 0 0 4px 1px rgba(255, 65, 54, 0.15); z-index: 3; pointer-events: none; animation: scanline-log 6s linear infinite; }

@keyframes scanline-log { 0% { transform: translateY(0%); opacity: 0.1; } 50% { opacity: 0.3; } 100% { transform: translateY(calc(100% - 2px)); opacity: 0.1; } }


/* === Info/Lobby Column Specifics === */
.stats-panel { max-height: 250px; }
#dashboard-game-title { /* Style added by dashboard.js */ font-weight: bold; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #555; color: #4CAF50; font-family: "'VT323', monospace"; font-size: 18px; display: none; }
.robot-stat { border-left: 3px solid #888; margin-bottom: 8px; padding: 5px 5px 5px 8px; font-family: "'VT323', monospace"; font-size: 15px; }
.robot-stat div { margin-bottom: 2px; }
.robot-stat strong { color: #eee; }

#lobby-area { border-top: none; padding: 10px; flex-grow: 1; max-height: none; }
#lobby-area h3 { font-size: 18px; }
#lobby-status { margin-bottom: 10px; font-weight: bold; color: #e0e0e0; flex-shrink: 0; font-size: 16px; }
#event-log { max-height: 150px; flex-grow: 1; flex-shrink: 1; min-height: 80px; background: #222; font-size: 14px; border: 1px solid #555; overflow-y: scroll; margin-bottom: 10px; padding: 5px 8px; }
#chat-area { display: flex; gap: 5px; flex-shrink: 0; margin-top: 10px; }
#chat-input { flex-grow: 1; padding: 8px; border-radius: 4px; border: 1px solid #555; background: #2a2a2a; color: #e0e0e0; font-family: 'VT323', monospace; font-size: 14px; }
#send-chat { padding: 8px 16px; font-size: 15px; }

#game-history-log { max-height: 220px; }
#game-history-log h4 { font-size: 18px; }
#game-history-list { font-size: 14px; }
#game-history-list > div { margin-bottom: 4px; padding-bottom: 4px; border-bottom: 1px dashed #444; color: #cccccc; }
#game-history-list > div:last-child { border-bottom: none; margin-bottom: 0; }


/* --- Responsive Adjustments --- */
@media (max-width: 1100px) {
    .main-content-grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        overflow-y: auto;
        overflow-x: hidden;
    }
    .arena-column {
        min-height: auto; /* Allow natural height */
        overflow: visible; /* Prevent hiding content */
    }
    #arena {
        max-height: 60vh;
        width: auto;
        max-width: 90%;
        margin: 0 auto;
        flex-grow: 0; /* Don't let arena grow excessively when stacked */
    }
    .consoles-row {
        flex-direction: column; /* Stack consoles vertically */
        max-height: 400px; /* Allow more total height for stacked consoles */
    }
     .consoles-row .console-panel {
         max-height: 190px; /* Limit individual console height */
     }

    .devtools-column, .info-lobby-column {
         min-height: auto;
         overflow: visible;
    }
    .stats-panel, #lobby-area, #game-history-log, .editor-section, .api-help {
        max-height: 350px; /* Generous max-height for stacked panels */
        overflow: hidden;
    }
    .editor-section {
        min-height: 400px;
        max-height: 60vh;
    }
    #lobby-area { flex-grow: 0; max-height: 400px; }
}

@media (max-width: 768px) {
    body { font-size: 18px; }
    .container { padding: 10px; }
    header { flex-direction: column; align-items: center; gap: 10px; }
    header img.header-logo { max-height: 30px; }
    header h1 { font-size: 1.4rem; }
    nav { justify-content: center; gap: 5px; width: 100%; }
    button, select, input#playerName { font-size: 14px; padding: 6px 10px;}
    #btn-delete-loadout { font-size: 12px; padding: 3px 6px;}

    .main-content-grid { gap: 10px; }
    .devtools-column, .info-lobby-column, .arena-column { gap: 10px; } /* Consistent gap */

    #arena { max-height: 50vh; }

    .consoles-row { max-height: 350px; gap: 10px; } /* Stacked consoles on mobile too */
    .consoles-row .console-panel { max-height: 170px; padding: 8px 10px; }

    .stats-panel, #lobby-area, #game-history-log, .editor-section, .api-help {
        max-height: 300px;
        padding: 8px 10px;
    }
     .api-help { max-height: 150px; }
    .editor-section { min-height: 350px; max-height: 50vh;}
    .CodeMirror { font-size: 15px; }
    .log-box, #game-history-list, #event-log { font-size: 13px; }
    .robot-stat { font-size: 13px; }
}